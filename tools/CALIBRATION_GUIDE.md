# Calibration Tool Quick Reference

## Setup
```bash
cp src/main.cpp src/main.cpp.backup
cp tools/cal_lcd.cpp src/main.cpp
# Build and upload to Arduino Due
# Open serial monitor at 115200 baud
```

## Commands

### Display Orientation
- `rot0` - Portrait (0째)
- `rot1` - Landscape (90째)
- `rot2` - Reverse Portrait (180째)
- `rot3` - Reverse Landscape (270째)

### Calibration Tests
- `frame` - Draw nested frames to identify visible bounds
- `cross` - Draw diagonal line from origin to center
- `center` - Draw cross at calculated usable center (requires bounds set)

### Set Calibration Values
```
bounds L,R,T,B
```
Example: `bounds 1,158,2,127`
- L = left edge (x-coordinate)
- R = right edge (x-coordinate)
- T = top edge (y-coordinate)
- B = bottom edge (y-coordinate)

### Export Configuration
```
export
```
Outputs TOML config file. Copy output between BEGIN/END markers.

### Utility
- `clear` - Clear screen to black
- `info` - Show current calibration values
- `help` - Show command list

## Typical Workflow

```
> rot1                    # Set to landscape
> frame                   # Visual test - press key between steps
> bounds 1,158,2,127      # Set observed bounds
> center                  # Verify center calculation
> export                  # Generate config output
```

## Example Session

```
ST7735 Display Calibration Tool v1.0
Connected! Ready for commands.

> rot1
Rotation set to: 1
Display size: 160 x 128
Use 'cross' command to see origin-to-center line.

> frame
Frame test - stepping through insets. Press any key to continue between steps...
Step 1: White frame at nominal bounds (0,0) to (159,127)
Press any key to continue...
[press key]
Step 2: Added red frame with 1-pixel inset
Press any key to continue...
[press key]
Step 3: Added green frame with 2-pixel inset
Press any key to continue...
[press key]
Step 4: Added blue frame with 3-pixel inset
Examine which frames are fully visible to determine usable bounds.

> bounds 1,158,2,127
Usable bounds set:
  Left: 1, Right: 158
  Top: 2, Bottom: 127
  Usable area: 158x126
  Center: (80, 65)

> center
Red cross drawn at usable center: (80,65)
Green rectangle shows usable area boundary.

> export

========== BEGIN CONFIG FILE ==========
# ST7735 Display Configuration
# Format: TOML v1.0.0
# Generated by cal_lcd.cpp

[device]
name = "DueLCD_NEW"  # TODO: Change to unique device name
manufacturer = "Unknown"  # TODO: Set manufacturer
model = "ST7735"  # TODO: Set model
published_resolution = [160, 128]

[pinout]
# Arduino Due pin assignments
rst = 8
dc = 10
cs = 7
bl = 9

[calibration]
orientation = "landscape"
# Usable area bounds (0-indexed, inclusive)
left = 1
right = 158
top = 2
bottom = 127
# Calculated center point
center = [80, 65]
=========== END CONFIG FILE ===========

Copy the text between BEGIN/END and save as <DeviceName>.config
Then run: python3 generate_config_header.py --device <DeviceName>
```

## After Calibration

1. Copy config output to file:
   ```bash
   nano DueLCD03.config  # Paste config, edit device fields
   ```

2. Generate C++ header:
   ```bash
   python3 generate_config_header.py --device DueLCD03
   ```

3. Restore original main.cpp:
   ```bash
   mv src/main.cpp.backup src/main.cpp
   ```

4. Use new config:
   ```bash
   python3 bitmap_sender.py --device DueLCD03 image.jpg
   ```
